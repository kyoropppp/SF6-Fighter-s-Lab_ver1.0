# ストリートファイター6キャラクターデータベース

## プロジェクト概要

ストリートファイター6のキャラクター対策、強い行動、コンボレシピを管理するWebベースのデータベース。汎用的なデータ構造により他の格闘ゲームにも応用可能。

## 技術スタック

- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6+)
- **Storage**: localStorage (自動保存)
- **Data Format**: JSON

## 設計原則

### 1. 汎用性重視
格闘ゲーム全般に適用可能な "strategies"（対策）、"actions"（強い行動）、"combos"（コンボ） の3カテゴリ構造を採用。キャラクター名やゲームタイトルを変更するだけで他ゲームに転用可能。

### 2. 統一データ管理
全データを単一ファイル（data.json）で管理することで以下の利点を実現：

#### データ管理の簡素化
- **一元管理**: 全キャラクターデータが1つのファイルに集約
- **整合性保証**: データの一貫性を容易に維持
- **バックアップ効率**: 1ファイルで完全なデータバックアップ

#### エクスポート/インポートとの整合性
- **完全互換**: エクスポートしたファイルをそのまま初期データとして利用可能
- **環境移行**: 1ファイルで他の環境へ完全移植
- **データ配布**: コミュニティでのデータ共有が簡単

#### 汎用性の実現
- **ゲーム横断対応**: "strategies", "actions", "combos" 構造は格闘ゲーム全般に適用
- **拡張性**: 新カテゴリの追加が容易
- **プラットフォーム移植性**: 他のツールやアプリケーションでの再利用が可能

### 3. 動的カテゴリ拡張
固定カテゴリに加え、ユーザーが任意のカテゴリを作成可能。categoryNames による表示名管理で、柔軟性と拡張性を両立。

### 4. データ永続化
- **データ保存**: 編集内容は自動的にブラウザに保存される
- **エクスポート**: 保存されたデータをJSONファイルとして出力
- **インポート**: JSONファイルでブラウザの保存データを更新
- **永続性**: ブラウザを閉じても次回起動時にデータを保持

### 5. 編集機能
- Web上でのリアルタイム編集
- カテゴリの動的追加・削除
- バリデーション機能

### 6. データとコードの分離
- **サンプルデータ関数の禁止**: アプリケーションコード内にサンプルデータ生成関数を作成しない
- **外部データ管理**: 全てのデータ（サンプル含む）はdata.jsonファイルで管理
- **統一的なデータ処理**: 初回起動時はdata.jsonからの読み込みのみ実行
- **保守性向上**: データとロジックの完全分離により、データ更新時にコード修正が不要

## ファイル構成

```
sf6_database_ver2/
├── index.html                   # メインHTML
├── css/
│   └── style.css               # アプリケーションスタイル
├── js/
│   ├── app.js                  # アプリケーション制御
│   ├── character.js            # キャラクター表示
│   ├── data-loader.js          # データ読み込み
│   ├── data.js                 # データ管理・ストレージ統合
│   ├── editor.js               # 編集機能
│   └── storage.js              # データ保存・読み込み
└── data/
    └── data.json              # 全データ統一ファイル
```

## 主要機能

### キャラクター選択
- 18キャラクターの一覧表示
- キャラクターアイコンクリックで詳細表示

### データ表示モード
1. **対策**: 確定反撃、対空、弱点対処
2. **強い行動**: 主力技、連係、起き攻め
3. **コンボ**: 基本、状況別、ゲージ使用コンボ
4. **データ管理**: 保存・インポート・エクスポート

### データ編集
- 編集モードでリアルタイム編集
- カテゴリ・アイテムの追加・削除
- 自動保存（localStorage）

### データ管理
- JSONファイルからインポート
- データエクスポート
- 設定ファイルからサンプルデータ読み込み

## データ構造

### 統一データフォーマット
全ての項目（対策・強い行動・コンボ）で統一された構造を使用：
```json
{
  "item_name": "項目名",
  "content": "内容",
  "description": "詳細説明"
}
```

### キャラクターデータ構造
```json
{
  "characterId": "ryu",
  "characterName": "リュウ",
  "categoryNames": {
    "punishes": "確定反撃",
    "antiAir": "対空対策",
    "weaknesses": "弱点・対処法",
    "user1": "俺的ワンポイント対策"
  },
  "punishes": [
    {
      "item_name": "波動拳",
      "content": "タイミングを合わせてジャンプ攻撃",
      "description": "中距離から波動拳を撃たれた場合の対処"
    }
  ],
  "antiAir": [
    {
      "item_name": "ジャンプ大K",
      "content": "ジャストパリィ or 屈大P or 昇竜拳",
      "description": "リュウの大Kは長いので、きついと思ったらガードでも全然いい"
    }
  ],
  "user1": [
    {
      "item_name": "ラッシュ対策",
      "content": "ラッシュをガン見して、立Pで止める",
      "description": "距離に合わせて小中大を選択"
    }
  ]
}
```

### カテゴリ別標準構造

#### 対策（strategies）
- **punishes**: 確定反撃
- **antiAir**: 対空対策  
- **weaknesses**: 弱点・対処法

#### 強い行動（actions）
- **strongMoves**: 主力技
- **strongSequences**: 強力な連係
- **okizeme**: 起き攻め・セットプレイ

#### コンボ（combos）
- **basicCombos**: 基本コンボ
- **situationalCombos**: 状況別コンボ
- **meterCombos**: ゲージ使用コンボ

### ユーザ作成カテゴリの仕組み

#### カテゴリ作成プロセス
1. 編集モードで「新しいカテゴリを追加」ボタンをクリック
2. ユーザがカテゴリ名を入力（例：「俺的コンボ」）
3. システムが内部キー "user1", "user2", "user3"... を自動割り当て
4. `categoryNames` に追加：
   ```json
   "categoryNames": {
     "punishes": "確定反撃",
     "user1": "俺的コンボ"
   }
   ```
5. 対応するデータ配列を初期化：
   ```json
   "user1": []
   ```

#### アイテム追加プロセス
1. ユーザ作成カテゴリで「新しいアイテムを追加」をクリック
2. 編集フォームが表示：
   - **アイテム名**: 技名やコンボ名など
   - **内容**: 基本的な情報や手順
   - **説明**: 詳細な解説や注意点
3. 保存時に統一フォーマットで配列に追加

### HTMLとJSON連携

#### 動的ヘッダー表示
- `index.html` では静的なキャラクター一覧を定義
- `character.js` の `renderCounterStrategies()` 等がJSONの `categoryNames` を参照
- カテゴリヘッダーはJSONの表示名を動的に表示：
  ```javascript
  Object.entries(categoryNames).forEach(([key, name]) => {
      // name = "確定反撃" や "俺的コンボ" 等のユーザー表示名
      container.innerHTML += `<h3>${name}</h3>`;
  });
  ```

### データ管理原則
- **単一データソース**: data.jsonがサンプルデータも含む全データの唯一のソース
- **アプリケーションの役割**: データ読み込み・表示・編集機能のみ提供
- **データ統一性**: サンプルデータもユーザーデータも同一の形式・手順で管理
- **関数分離**: アプリケーションコード内にサンプルデータ生成関数は含まない

## インポート・エクスポート形式

### 基本仕様
**エクスポートしたJSONファイルはそのままインポート可能**

### データファイル構造（data.json）
```json
{
  "characters": {
    "characters": [...]
  },
  "strategies": [
    {
      "characterId": "ryu",
      "characterName": "リュウ",
      "categoryNames": {
        "punishes": "確定反撃",
        "antiAir": "対空対策"
      },
      "punishes": [...],
      "antiAir": [...]
    }
  ],
  "actions": [
    {
      "characterId": "ryu",
      "characterName": "リュウ",
      "categoryNames": {
        "strongMoves": "主力技",
        "strongSequences": "強力な連係"
      },
      "strongMoves": [...],
      "strongSequences": [...]
    }
  ],
  "combos": [
    {
      "characterId": "ryu",
      "characterName": "リュウ",
      "categoryNames": {
        "basicCombos": "基本コンボ",
        "situationalCombos": "状況別コンボ"
      },
      "basicCombos": [...],
      "situationalCombos": [...]
    }
  ],
  "settings": {
    "display": {...},
    "characterOrder": [...],
    "userSettings": {...}
  }
}
```

### エクスポート形式
- **処理ファイル**: editor.js
- **出力ファイル名**: sf6_database_export.json
- **形式**: フラット形式（トップレベルキー配置）

### インポート対応形式
- **処理ファイル**: storage.js
- **対応形式**: フラット形式・ネスト形式の両方

#### フラット形式（エクスポートファイル互換）
```json
{
  "characters": {...},
  "strategies": [...],
  "actions": [...],
  "combos": [...],
  "settings": {...}
}
```

#### ネスト形式（個別JSONファイル）
```json
{
  "characters": {...},
  "counterStrategies": {
    "strategies": [...]
  },
  "strongActions": {
    "actions": [...]
  },
  "comboRecipes": {
    "combos": [...]
  },
  "settings": {...}
}
```

### バリデーション要件
- 全キャラクターデータで `categoryNames` オブジェクト必須
- フラット・ネスト形式問わず同一バリデーション適用
- エラー時は具体的なキャラクターIDとともにエラー出力

## 実装・開発ガイド

### 初回セットアップ
1. プロジェクトファイルをローカルに配置
2. ブラウザでindex.htmlを開く
3. データ読み込みUI画面で以下のいずれかを選択：
   - **サンプルデータ使用**: data/data.jsonから読み込み
   - **ファイル選択**: 独自のdata.jsonファイルを指定
4. データがlocalStorageに自動保存され、以降は自動読み込み

### 開発手順
1. **データ準備**: data.jsonファイルを作成または用意
2. **カスタマイズ**: 必要に応じてキャラクター情報を追加・修正
3. **起動**: index.htmlをブラウザで開く
4. **編集**: Web上でリアルタイム編集
5. **バックアップ**: 定期的にエクスポート機能でデータ保存

### サンプルデータ管理
**重要**: アプリケーションコード内にサンプルデータ生成関数は作成しない

#### サンプルデータ作成手順
1. **data.json編集**: サンプルデータはdata.jsonファイルに直接記述
2. **データ形式**: 本番データと同一の形式（strategies/actions/combos構造）
3. **初回起動**: data.jsonをインポート機能で読み込み
4. **更新時**: data.jsonを編集 → 再インポート

#### 設計理由
- **コード汚染防止**: サンプルデータ関数がコードベースに紛れ込むことを防止
- **データ一元管理**: 全てのデータをdata.jsonで統一管理
- **保守性**: データ更新時にコード修正が不要
- **一貫性**: サンプルデータも本番データも同一の処理フローで管理

### キーボードショートカット
- `Ctrl+S`: データ保存
- `Ctrl+F`: 検索フォーカス  
- `Ctrl+O`: ファイルインポート
- `ESC`: 検索クリア
- `1-4`: タブ切り替え

## 運用

### データ管理フロー
1. **編集**: 編集モードでリアルタイム更新（自動保存）
2. **バックアップ**: エクスポート機能で sf6_database_export.json 生成
3. **移行**: エクスポートファイルを他環境でインポート
4. **復旧**: バックアップファイルからデータ復元

### 他ゲームへの応用
1. data.jsonのcharacters配列を対象ゲームのキャラクターに変更
2. categoryNamesの表示名を適宜調整
3. 基本的なデータ構造（strategies/actions/combos）はそのまま利用可能

### メンテナンス
- **データ更新**: Web編集またはdata.json直接編集
- **設定変更**: settings内でテーマ・表示順序等を調整
- **トラブル時**: エクスポートファイルからデータ復旧

このアーキテクチャにより、格闘ゲーム攻略データベースとしての汎用性と、ユーザビリティを両立したシステムを実現している。